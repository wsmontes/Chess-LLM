<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Chess LLM - Play Chess Against AI</title>
    <meta name="description" content="Play chess against AI powered by local LLM or OpenAI. Beautiful, responsive chess game with thinking visualization.">
    
    <!-- Preload critical resources -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" crossorigin="anonymous">
    
    <!-- Styles -->
    <link rel="stylesheet" href="styles.css">
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#2563eb">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Chess LLM">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="game-header">
            <h1>
                <i class="fas fa-chess-king"></i>
                <span>Chess LLM</span>
            </h1>
            <div class="game-info">
                <div class="player-info">
                    <div class="player human-player">
                        <i class="fas fa-user"></i>
                        <span>You (White)</span>
                    </div>
                    <div class="player ai-player">
                        <i class="fas fa-robot"></i>
                        <span id="ai-player-label">AI (Black)</span>
                    </div>
                </div>
                <div class="game-status">
                    <span id="status-text">Your turn - White to move</span>
                    <div class="thinking-indicator" id="thinking-indicator">
                        <i class="fas fa-cog fa-spin"></i>
                        <span>AI is thinking...</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Mobile Navigation -->
        <nav class="mobile-nav" id="mobile-nav">
            <div class="nav-tabs">
                <button class="nav-tab active" data-tab="board">
                    <i class="fas fa-chess-board"></i> Board
                </button>
                <button class="nav-tab" data-tab="thinking">
                    <i class="fas fa-brain"></i> AI Thinking
                </button>
                <button class="nav-tab" data-tab="history">
                    <i class="fas fa-history"></i> History
                </button>
                <button class="nav-tab" data-tab="controls">
                    <i class="fas fa-gamepad"></i> Controls
                </button>
                <button class="nav-tab" data-tab="settings">
                    <i class="fas fa-cogs"></i> Settings
                </button>
            </div>
        </nav>

        <!-- Main Game Area -->
        <main class="game-container">
            <!-- Chess Board Section -->
            <section class="game-board-container" id="board-section">
                <div class="board-wrapper">
                    <div class="coordinate-labels">
                        <div class="rank-labels">
                            <div class="rank-label">8</div>
                            <div class="rank-label">7</div>
                            <div class="rank-label">6</div>
                            <div class="rank-label">5</div>
                            <div class="rank-label">4</div>
                            <div class="rank-label">3</div>
                            <div class="rank-label">2</div>
                            <div class="rank-label">1</div>
                        </div>
                        <div class="chess-board" id="chess-board" role="grid" aria-label="Chess board">
                            <!-- Board squares will be generated by JavaScript -->
                        </div>
                        <div class="file-labels">
                            <div class="file-label">a</div>
                            <div class="file-label">b</div>
                            <div class="file-label">c</div>
                            <div class="file-label">d</div>
                            <div class="file-label">e</div>
                            <div class="file-label">f</div>
                            <div class="file-label">g</div>
                            <div class="file-label">h</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Game Panel -->
            <aside class="game-panel">
                <!-- AI Thinking Panel -->
                <section class="panel-section" id="thinking-section">
                    <div class="panel-header">
                        <h3>
                            <i class="fas fa-brain"></i>
                            AI Thinking Process
                        </h3>
                        <label class="thinking-toggle">
                            <input type="checkbox" id="thinking-toggle" checked aria-label="Show AI thinking process">
                            <span>Show thinking</span>
                        </label>
                    </div>
                    <div class="panel-content">
                        <div class="thinking-content" id="thinking-content" role="log" aria-live="polite" aria-label="AI thinking process">
                            <div class="thinking-placeholder">
                                AI thinking process will appear here during moves
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Move History Panel -->
                <section class="panel-section" id="history-section">
                    <div class="panel-header">
                        <h3>
                            <i class="fas fa-history"></i>
                            Move History
                        </h3>
                    </div>
                    <div class="panel-content">
                        <div class="moves-container" id="moves-container" role="log" aria-live="polite" aria-label="Move history">
                            <div class="no-moves">Game hasn't started yet</div>
                        </div>
                    </div>
                </section>

                <!-- Game Controls Panel -->
                <section class="panel-section" id="controls-section">
                    <div class="panel-header">
                        <h3>
                            <i class="fas fa-gamepad"></i>
                            Game Controls
                        </h3>
                    </div>
                    <div class="panel-content">
                        <div class="game-controls">
                            <button class="control-btn success" id="new-game-btn" aria-label="Start a new game">
                                <i class="fas fa-plus"></i>
                                <span>New Game</span>
                            </button>
                            <button class="control-btn secondary" id="undo-btn" disabled aria-label="Undo last move">
                                <i class="fas fa-undo"></i>
                                <span>Undo</span>
                            </button>
                            <button class="control-btn" id="hint-btn" aria-label="Get a hint for your next move">
                                <i class="fas fa-lightbulb"></i>
                                <span>Get Hint</span>
                            </button>
                        </div>
                    </div>
                </section>

                <!-- Settings Panel -->
                <section class="panel-section" id="settings-section">
                    <div class="panel-header">
                        <h3>
                            <i class="fas fa-cogs"></i>
                            AI Settings
                        </h3>
                    </div>
                    <div class="panel-content">
                        <div class="setting-group">
                            <label for="llm-provider">AI Provider:</label>
                            <select id="llm-provider" aria-describedby="provider-help">
                                <option value="lmstudio">LM Studio (Local)</option>
                                <option value="openai">OpenAI GPT (Cloud)</option>
                            </select>
                            <small class="setting-help" id="provider-help">
                                Choose between local AI (free, private) or cloud AI (paid, more powerful)
                            </small>
                        </div>

                        <!-- LM Studio Settings -->
                        <div id="lmstudio-settings">
                            <div class="setting-group">
                                <label for="llm-model">Model Name:</label>
                                <input type="text" id="llm-model" value="google/gemma-3-4b" placeholder="Enter model name" aria-describedby="model-help">
                                <small class="setting-help" id="model-help">
                                    Model name as shown in LM Studio
                                </small>
                            </div>
                            <div class="setting-group">
                                <label for="llm-endpoint">API Endpoint:</label>
                                <input type="text" id="llm-endpoint" value="http://localhost:1234" placeholder="http://localhost:1234" aria-describedby="endpoint-help">
                                <small class="setting-help" id="endpoint-help">
                                    LM Studio server URL (usually localhost:1234)
                                </small>
                            </div>
                        </div>

                        <!-- OpenAI Settings -->
                        <div id="openai-settings" style="display: none;">
                            <div class="setting-group">
                                <label for="openai-api-key">API Key:</label>
                                <input type="password" id="openai-api-key" placeholder="sk-..." autocomplete="off" aria-describedby="apikey-help">
                                <small class="setting-help" id="apikey-help">
                                    Your OpenAI API key (stored securely in browser)
                                </small>
                                <div class="security-notice">
                                    <i class="fas fa-shield-alt"></i>
                                    Your API key is encrypted and stored locally. It never leaves your device except for API calls to OpenAI.
                                </div>
                            </div>
                            <div class="setting-group">
                                <label for="openai-model">Model:</label>
                                <select id="openai-model" aria-describedby="openai-model-help">
                                    <option value="gpt-3.5-turbo">GPT-3.5 Turbo (Fast & Affordable)</option>
                                    <option value="gpt-3.5-turbo-1106">GPT-3.5 Turbo (Latest)</option>
                                    <option value="gpt-4">GPT-4 (Most Capable)</option>
                                    <option value="gpt-4-turbo-preview">GPT-4 Turbo (Best Performance)</option>
                                </select>
                                <small class="setting-help" id="openai-model-help">
                                    Higher quality models cost more per move
                                </small>
                            </div>
                        </div>

                        <div class="setting-group">
                            <label for="llm-temperature">
                                Creativity Level: 
                                <span id="temperature-value">0.3</span>
                            </label>
                            <input type="range" id="llm-temperature" min="0" max="1" step="0.1" value="0.3" aria-describedby="temperature-help">
                            <small class="setting-help" id="temperature-help">
                                Higher values make the AI more creative but less predictable
                            </small>
                        </div>
                        
                        <div class="connection-status" id="connection-status" role="status" aria-live="polite">
                            <i class="fas fa-circle"></i>
                            <span>Not connected</span>
                        </div>
                    </div>
                </section>
            </aside>
        </main>
    </div>

    <!-- Game Over Modal -->
    <div class="modal" id="game-over-modal" role="dialog" aria-labelledby="game-result-title" aria-describedby="game-result-message">
        <div class="modal-content">
            <h2 id="game-result-title">Game Over</h2>
            <p id="game-result-message">The game has ended.</p>
            <div class="modal-actions">
                <button class="control-btn success" id="new-game-modal-btn">
                    <i class="fas fa-plus"></i>
                    <span>New Game</span>
                </button>
                <button class="control-btn secondary" id="close-modal-btn">
                    <i class="fas fa-times"></i>
                    <span>Close</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Scripts - loaded in dependency order -->
    <script src="secure-storage.js"></script>
    <script src="chess-engine.js"></script>
    <script src="llm-client.js"></script>
    <script src="ui/board-manager.js"></script>
    <script src="ui/settings-manager.js"></script>
    <script src="ui/thinking-display.js"></script>
    <script src="ui/move-handler.js"></script>
    <script src="ui/game-controller.js"></script>
    <script src="chess-ui.js"></script>
    <script src="main.js"></script>
</body>
</html>
